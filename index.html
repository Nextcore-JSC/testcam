<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ch·ª•p ·∫¢nh V·ªõi Th·ªùi Gian & ƒê·ªãa ƒêi·ªÉm</title>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; }
        input { margin: 10px; }
        img, canvas { width: 100%; max-width: 500px; }
    </style>
</head>
<body>
    <h2>Web Ch·ª•p ·∫¢nh</h2>
    
    <!-- Input ƒë·ªÉ m·ªü camera -->
    <input type="file" accept="image/*" capture="environment" id="cameraInput">
    
    <!-- Hi·ªÉn th·ªã ·∫£nh ch·ª•p -->
    <img id="preview" style="display: none;">
    
    <!-- Canvas ƒë·ªÉ v·∫Ω ·∫£nh & th√¥ng tin -->
    <canvas id="canvas" style="display: none;"></canvas>
    
    <p id="locationText">ƒêang l·∫•y v·ªã tr√≠...</p>

    <script>
        const cameraInput = document.getElementById("cameraInput");
        const preview = document.getElementById("preview");
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        const locationText = document.getElementById("locationText");

        let latitude = "", longitude = "", address = "ƒêang l·∫•y ƒë·ªãa ch·ªâ...";

        // L·∫•y v·ªã tr√≠ GPS
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(position => {
                latitude = position.coords.latitude.toFixed(5);
                longitude = position.coords.longitude.toFixed(5);
                locationText.textContent = `V·ªã tr√≠: ${latitude}, ${longitude}`;
                getAddress(latitude, longitude);
            }, () => locationText.textContent = "Kh√¥ng th·ªÉ l·∫•y v·ªã tr√≠!");
        }

        // L·∫•y ƒë·ªãa ch·ªâ t·ª´ OpenStreetMap
        async function getAddress(lat, lon) {
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=18&addressdetails=1`);
                const data = await response.json();
                address = data.display_name || "Kh√¥ng t√¨m th·∫•y ƒë·ªãa ch·ªâ";
                locationText.textContent = `V·ªã tr√≠: ${address}`;
            } catch (error) {
                console.error("L·ªói l·∫•y ƒë·ªãa ch·ªâ:", error);
                address = "L·ªói l·∫•y ƒë·ªãa ch·ªâ";
            }
        }

        // Khi ng∆∞·ªùi d√πng ch·ª•p ·∫£nh
        cameraInput.addEventListener("change", function(event) {
            const file = event.target.files[0];
            if (file) {
                const imgURL = URL.createObjectURL(file);
                preview.src = imgURL;
                preview.style.display = "block";

                // V·∫Ω ·∫£nh l√™n canvas
                const img = new Image();
                img.onload = function () {
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                    // Hi·ªÉn th·ªã th·ªùi gian
                    const now = new Date().toLocaleString("vi-VN");

                    // Th√™m th√¥ng tin l√™n ·∫£nh
                    ctx.font = "30px Arial";
                    ctx.fillStyle = "red";
                    ctx.fillText(`üìç ${address}`, 20, 50);
                    ctx.fillText(`üïí ${now}`, 20, 90);

                    // C·∫≠p nh·∫≠t ·∫£nh c√≥ ch·ªØ
                    preview.src = canvas.toDataURL("image/png");
                };
                img.src = imgURL;
            }
        });
    </script>
</body>
</html>
